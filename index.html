<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Games Launcher - Paid Version</title>
  <meta name="description" content="Premium games launcher" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Space+Grotesk:wght@500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#000000;
      --card:#0a0a0f;
      --muted:#8b92a8;
      --accent:#1e90ff;
      --accent-glow:rgba(30,144,255,0.4);
      --blue:#00bfff;
      --dark-blue:#0047ab;
      --purple:#8b5cf6;
      --cyan:#06b6d4;
    }
    
    *{box-sizing:border-box;margin:0;padding:0}
    
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @keyframes shimmer{0%{background-position:-1000px 0}100%{background-position:1000px 0}}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
    @keyframes glow{0%,100%{box-shadow:0 0 20px var(--accent-glow)}50%{box-shadow:0 0 40px var(--accent-glow),0 0 60px var(--accent-glow)}}
    @keyframes slideUp{from{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
    @keyframes spin{to{transform:rotate(360deg)}}
    @keyframes gradientShift{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}
    @keyframes rotate{from{transform:rotate(0)}to{transform:rotate(360deg)}}
    @keyframes slideIn{from{transform:translateX(-50px);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes scaleIn{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}
    @keyframes neonPulse{0%,100%{filter:drop-shadow(0 0 5px var(--blue)) drop-shadow(0 0 15px var(--blue))}50%{filter:drop-shadow(0 0 10px var(--cyan)) drop-shadow(0 0 25px var(--cyan))}}
    
    .loading-screen{
      position:fixed;
      inset:0;
      background:linear-gradient(135deg,#000000 0%,#0a0020 25%,#001a33 50%,#0a0020 75%,#000000 100%);
      background-size:400% 400%;
      animation:gradientShift 8s ease infinite;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      z-index:9999;
      transition:opacity .8s ease,visibility .8s ease;
      overflow:hidden
    }

    .loading-screen::before{
      content:'';
      position:absolute;
      width:200%;
      height:200%;
      background:radial-gradient(circle,rgba(30,144,255,0.1) 0%,transparent 70%);
      animation:rotate 20s linear infinite
    }
    
    .loading-screen.hidden{opacity:0;visibility:hidden}
    .loading-content{
      text-align:center;
      animation:scaleIn 1s ease;
      position:relative;
      z-index:1
    }
    
    .loading-title{
      font-size:56px;
      font-weight:900;
      font-family:'Space Grotesk',sans-serif;
      background:linear-gradient(135deg,#00bfff 0%,#1e90ff 25%,#8b5cf6 50%,#1e90ff 75%,#00bfff 100%);
      background-size:300% 300%;
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      margin-bottom:30px;
      animation:pulse 2s ease-in-out infinite,gradientShift 8s ease infinite;
      letter-spacing:-2px;
      filter:drop-shadow(0 0 20px rgba(30,144,255,0.5))
    }
    
    .loading-spinner{
      width:70px;
      height:70px;
      border:5px solid rgba(30,144,255,.15);
      border-top-color:var(--blue);
      border-right-color:var(--purple);
      border-radius:50%;
      animation:spin .8s linear infinite;
      margin:30px auto;
      filter:drop-shadow(0 0 10px var(--blue))
    }
    
    body{
      margin:0;
      font-family:'Inter',system-ui,-apple-system,sans-serif;
      background:#000000;
      color:#f0f4f8;
      min-height:100vh;
      position:relative;
      overflow-x:hidden
    }
    
    body::before{
      content:'';
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:
        radial-gradient(circle at 15% 20%, rgba(30,144,255,.2) 0%, transparent 40%),
        radial-gradient(circle at 85% 80%, rgba(139,92,246,.15) 0%, transparent 40%),
        radial-gradient(circle at 50% 50%, rgba(6,182,212,.1) 0%, transparent 50%),
        linear-gradient(135deg,#000000 0%,#001a33 25%,#000d1a 50%,#0a0020 75%,#000000 100%);
      background-size:400% 400%;
      animation:gradientShift 25s ease infinite;
      pointer-events:none;
      z-index:0
    }
    
    body::after{
      content:'';
      position:fixed;
      top:-50%;
      left:-50%;
      width:200%;
      height:200%;
      background:
        radial-gradient(circle at 25% 25%,rgba(30,144,255,.08) 0%,transparent 25%),
        radial-gradient(circle at 75% 75%,rgba(139,92,246,.08) 0%,transparent 25%);
      animation:rotate 40s linear infinite;
      pointer-events:none;
      z-index:0;
      opacity:0.6
    }
    
    header{
      padding:28px 40px;
      border-bottom:1px solid rgba(30,144,255,.25);
      backdrop-filter:blur(20px) saturate(180%);
      background:rgba(0,10,20,.8);
      display:flex;
      gap:20px;
      align-items:center;
      position:sticky;
      top:0;
      z-index:100;
      animation:slideUp .8s ease;
      box-shadow:0 4px 30px rgba(0,0,0,.5)
    }
    
    header::after{
      content:'';
      position:absolute;
      bottom:-1px;
      left:0;
      width:100%;
      height:3px;
      background:linear-gradient(90deg,transparent,var(--blue),var(--purple),var(--cyan),transparent);
      animation:shimmer 4s linear infinite
    }
    
    .badge{
      display:inline-block;
      padding:10px 24px;
      background:linear-gradient(135deg,#0047ab 0%,#1e90ff 50%,#8b5cf6 100%);
      color:#fff;
      border-radius:30px;
      font-size:14px;
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:1.5px;
      animation:neonPulse 3s ease-in-out infinite;
      box-shadow:0 4px 20px rgba(30,144,255,.4),inset 0 1px 0 rgba(255,255,255,.2);
      font-family:'Space Grotesk',sans-serif;
      border:1px solid rgba(255,255,255,.1)
    }
    
    .made-by{
      margin-left:auto;
      font-size:15px;
      color:#a0aec0;
      padding:12px 24px;
      border-radius:12px;
      background:linear-gradient(135deg,rgba(30,144,255,.08),rgba(139,92,246,.08));
      backdrop-filter:blur(10px);
      border:1px solid rgba(30,144,255,.3);
      transition:all .4s cubic-bezier(.4,0,.2,1);
      font-weight:600;
      position:relative;
      overflow:hidden
    }

    .made-by::before{
      content:'';
      position:absolute;
      inset:0;
      background:linear-gradient(135deg,rgba(30,144,255,.15),rgba(139,92,246,.15));
      opacity:0;
      transition:opacity .4s ease
    }

    .made-by:hover::before{opacity:1}
    
    .made-by:hover{
      transform:translateY(-3px);
      box-shadow:0 10px 30px rgba(30,144,255,.3);
      border-color:var(--blue)
    }
    
    .made-by strong{
      color:transparent;
      background:linear-gradient(135deg,#00bfff,#8b5cf6);
      -webkit-background-clip:text;
      background-clip:text;
      font-weight:800;
      position:relative;
      z-index:1
    }
    
    .container{
      max-width:1400px;
      margin:40px auto;
      padding:0 40px;
      position:relative;
      z-index:1;
      animation:fadeIn 1s ease .3s both
    }
    
    .controls{
      display:flex;
      gap:14px;
      align-items:center;
      margin-bottom:40px;
      animation:slideIn 1s ease .5s both;
      flex-wrap:wrap
    }
    
    input[type="search"]{
      flex:1;
      min-width:250px;
      padding:18px 28px;
      border-radius:16px;
      border:2px solid rgba(30,144,255,.25);
      background:rgba(0,10,20,.9);
      backdrop-filter:blur(15px);
      color:#fff;
      font-size:16px;
      font-weight:500;
      transition:all .4s cubic-bezier(.4,0,.2,1);
      box-shadow:0 4px 20px rgba(0,0,0,.3)
    }
    
    input[type="search"]:focus{
      outline:none;
      border-color:var(--blue);
      box-shadow:0 0 40px var(--accent-glow),0 8px 30px rgba(30,144,255,.3);
      transform:translateY(-2px);
      background:rgba(0,20,40,.95)
    }
    
    input[type="search"]::placeholder{color:#4a5568;font-weight:500}
    
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
      gap:28px;
      margin-bottom:40px
    }
    
    .card{
      background:linear-gradient(135deg,rgba(0,10,20,.95) 0%,rgba(10,26,51,.9) 100%);
      border:2px solid rgba(30,144,255,.2);
      border-radius:24px;
      overflow:hidden;
      position:relative;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      height:280px;
      transition:all .5s cubic-bezier(.175,.885,.32,1.275);
      animation:fadeIn .5s ease both;
      box-shadow:0 8px 32px rgba(0,0,0,.4)
    }
    
    .card::before{
      content:'';
      position:absolute;
      inset:-3px;
      background:linear-gradient(135deg,var(--blue),var(--purple),var(--cyan));
      border-radius:24px;
      opacity:0;
      transition:opacity .5s ease;
      z-index:-1;
      filter:blur(15px)
    }

    .card::after{
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background:linear-gradient(180deg,transparent 0%,rgba(0,0,0,.3) 100%);
      opacity:0;
      transition:opacity .5s ease;
      pointer-events:none
    }
    
    .card:hover::before{opacity:1}
    .card:hover::after{opacity:1}
    
    .card:hover{
      transform:translateY(-16px) scale(1.04);
      box-shadow:0 30px 60px rgba(0,0,0,.6),0 0 60px var(--accent-glow);
      border-color:var(--cyan)
    }
    
    .card img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transition:transform .5s ease,filter .5s ease;
      filter:brightness(0.9)
    }
    
    .card:hover img{
      transform:scale(1.2);
      filter:brightness(1.1)
    }
    
    .card .label{
      position:absolute;
      left:0;
      right:0;
      bottom:0;
      padding:20px 22px;
      background:linear-gradient(180deg,transparent,rgba(0,0,0,.98) 30%);
      font-size:16px;
      font-weight:800;
      transition:all .4s ease;
      color:#fff;
      letter-spacing:.4px;
      text-shadow:0 2px 10px rgba(0,0,0,.8);
      z-index:1
    }
    
    .card:hover .label{
      background:linear-gradient(180deg,transparent,rgba(0,26,51,.98) 20%);
      padding-bottom:24px;
      color:transparent;
      background-clip:text;
      -webkit-background-clip:text;
      background-image:linear-gradient(135deg,#00bfff,#8b5cf6);
      text-shadow:0 0 20px rgba(30,144,255,.8)
    }
    
    .meta{font-size:14px;color:var(--muted);padding:10px 0 0}
    .center{text-align:center}
    
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.95);
      backdrop-filter:blur(25px);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      z-index:999;
      visibility:hidden;
      opacity:0;
      transition:all .4s ease
    }
    
    .modal-backdrop.show{visibility:visible;opacity:1}
    
    .modal{
      width:100%;
      max-width:1200px;
      height:85vh;
      background:linear-gradient(135deg,#000000 0%,#001a33 50%,#0a0020 100%);
      border-radius:30px;
      border:3px solid rgba(30,144,255,.5);
      display:flex;
      flex-direction:column;
      overflow:hidden;
      transform:scale(.85);
      transition:transform .4s ease;
      box-shadow:0 50px 100px rgba(0,0,0,.9),0 0 150px rgba(30,144,255,.3);
      position:relative
    }

    .modal::before{
      content:'';
      position:absolute;
      inset:-2px;
      background:linear-gradient(135deg,var(--blue),var(--purple),var(--cyan),var(--blue));
      background-size:300% 300%;
      animation:gradientShift 6s ease infinite;
      border-radius:30px;
      opacity:0.3;
      z-index:-1;
      filter:blur(20px)
    }
    
    .modal-backdrop.show .modal{transform:scale(1)}
    
    .modal header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:24px 32px;
      border-bottom:2px solid rgba(30,144,255,.3);
      background:rgba(0,10,20,.9);
      backdrop-filter:blur(20px)
    }
    
    .modal-title{
      font-weight:800;
      font-size:20px;
      letter-spacing:.5px;
      background:linear-gradient(135deg,#00bfff,#8b5cf6);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text
    }
    .modal .iframe-wrap{flex:1;background:#000;position:relative;overflow:hidden}
    iframe{width:100%;height:100%;border:0}
    
    .game-loader{
      position:absolute;
      inset:0;
      background:linear-gradient(135deg,#000000 0%,#001a33 100%);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      z-index:10;
      opacity:1;
      transition:opacity .5s ease;
    }

    .game-loader.hidden{
      opacity:0;
      pointer-events:none;
    }

    .game-loader-spinner{
      width:60px;
      height:60px;
      border:5px solid rgba(30,144,255,.15);
      border-top-color:var(--blue);
      border-right-color:var(--purple);
      border-radius:50%;
      animation:spin 0.8s linear infinite;
      margin-bottom:25px;
      filter:drop-shadow(0 0 15px var(--blue))
    }

    .game-loader-text{
      color:#a0aec0;
      font-size:16px;
      margin-bottom:10px;
      font-weight:600
    }

    .game-loader-tip{
      color:var(--blue);
      font-size:13px;
      font-style:italic;
      max-width:350px;
      text-align:center;
      line-height:1.6
    }

    .timeout-message{
      display:none;
      text-align:center;
      padding:30px;
    }

    .timeout-message.show{
      display:block;
    }

    .timeout-message h3{
      background:linear-gradient(135deg,#00bfff,#8b5cf6);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      margin-bottom:18px;
      font-size:22px;
      font-weight:800
    }

    .timeout-message p{
      color:var(--muted);
      margin-bottom:25px;
      line-height:1.7
    }
    
    .btn{
      background:linear-gradient(135deg,#0047ab 0%,#1e90ff 50%,#8b5cf6 100%);
      color:#fff;
      padding:14px 28px;
      border-radius:14px;
      border:0;
      cursor:pointer;
      font-weight:700;
      font-size:15px;
      transition:all .4s cubic-bezier(.4,0,.2,1);
      position:relative;
      overflow:hidden;
      box-shadow:0 6px 20px rgba(30,144,255,.4);
      letter-spacing:.6px;
      border:1px solid rgba(255,255,255,.1)
    }
    
    .btn::before{
      content:'';
      position:absolute;
      inset:0;
      background:linear-gradient(135deg,transparent,rgba(255,255,255,.3));
      transform:translateX(-100%);
      transition:transform .4s ease
    }
    
    .btn:hover::before{transform:translateX(100%)}
    .btn:hover{
      transform:translateY(-3px);
      box-shadow:0 12px 30px rgba(30,144,255,.5)
    }
    .btn:active{transform:translateY(0)}
    
    .btn.ghost{
      background:linear-gradient(135deg,rgba(30,144,255,.1),rgba(139,92,246,.1));
      border:2px solid rgba(30,144,255,.4);
      color:#fff;
      backdrop-filter:blur(10px)
    }
    
    .btn.ghost:hover{
      background:linear-gradient(135deg,rgba(30,144,255,.2),rgba(139,92,246,.2));
      border-color:var(--blue)
    }
    
    .small{padding:12px 22px;font-size:14px;border-radius:12px}
    
    .footer{
      margin-top:60px;
      padding:35px;
      color:var(--muted);
      font-size:15px;
      text-align:center;
      background:linear-gradient(135deg,rgba(0,10,20,.7),rgba(10,0,20,.7));
      border-radius:20px;
      border:2px solid rgba(30,144,255,.2);
      animation:fadeIn 1.2s ease .8s both;
      backdrop-filter:blur(15px);
      line-height:1.8;
      box-shadow:0 8px 32px rgba(0,0,0,.4);
      position:relative;
      overflow:hidden
    }

    .footer::before{
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:2px;
      background:linear-gradient(90deg,transparent,var(--blue),var(--purple),transparent);
      animation:shimmer 3s linear infinite
    }
    
    h2{
      margin:0 0 35px 0;
      font-size:42px;
      font-weight:900;
      font-family:'Space Grotesk',sans-serif;
      background:linear-gradient(135deg,#00bfff 0%,#1e90ff 30%,#8b5cf6 60%,#06b6d4 100%);
      background-size:300% 300%;
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      animation:float 5s ease-in-out infinite,gradientShift 10s ease infinite;
      letter-spacing:-1.5px;
      filter:drop-shadow(0 0 30px rgba(30,144,255,0.3))
    }

    .import-popup{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.97);
      backdrop-filter:blur(30px);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:10000;
      visibility:hidden;
      opacity:0;
      transition:all .4s ease
    }

    .import-popup.show{visibility:visible;opacity:1}

    .import-popup-content{
      background:linear-gradient(135deg,#000000 0%,#001a33 50%,#0a0020 100%);
      border:3px solid rgba(30,144,255,.6);
      border-radius:30px;
      padding:50px 60px;
      text-align:center;
      box-shadow:0 50px 100px rgba(0,0,0,.9),0 0 150px rgba(30,144,255,.5);
      animation:scaleIn 0.5s ease;
      position:relative;
      overflow:hidden
    }

    .import-popup-content::before{
      content:'';
      position:absolute;
      inset:-2px;
      background:linear-gradient(135deg,var(--blue),var(--purple),var(--cyan),var(--blue));
      background-size:300% 300%;
      animation:gradientShift 6s ease infinite;
      border-radius:30px;
      opacity:0.2;
      z-index:-1;
      filter:blur(20px)
    }

    .import-popup-content h3{
      font-size:32px;
      font-family:'Space Grotesk',sans-serif;
      background:linear-gradient(135deg,#00bfff 0%,#8b5cf6 50%,#06b6d4 100%);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      margin-bottom:25px;
      font-weight:900;
      filter:drop-shadow(0 0 20px rgba(30,144,255,0.5))
    }

    .import-popup-content p{
      font-size:17px;
      color:#a0aec0;
      line-height:1.8
    }
    
    @media (max-width:768px){
      .card{height:240px}
      .container{padding:0 24px}
      .made-by{font-size:13px;padding:10px 16px}
      .loading-title{font-size:32px}
      h2{font-size:32px}
      .controls{gap:10px}
      .grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:20px}
      .import-popup-content{padding:35px 45px}
      .import-popup-content h3{font-size:26px}
      header{padding:20px 24px}
    }
  </style>
</head>
<body>
  <div id="loadingScreen" class="loading-screen">
    <div class="loading-content">
      <div class="loading-title">Thank You For Purchasing</div>
      <div class="loading-spinner"></div>
    </div>
  </div>

  <div id="importPopup" class="import-popup">
    <div class="import-popup-content">
      <h3>‚úÖ Success!</h3>
      <p id="importMessage">Data imported successfully! Please log back in with your key.<br><br>Closing tab in <span id="countdown">5</span> seconds...</p>
    </div>
  </div>

  <header>
    <span class="badge">Paid Version</span>
    <div class="made-by">Made By <strong>Cavan</strong></div>
  </header>

  <main class="container">
    <div class="controls">
      <input id="search" type="search" placeholder="üîç Search games..." />
      <button id="refreshBtn" class="btn small">Refresh</button>
      <button id="exportBtn" class="btn small ghost">Export Data</button>
      <button id="importBtn" class="btn small ghost">Import Data</button>
      <input type="file" id="importFile" style="display:none" accept=".json">
    </div>

    <section>
      <h2>üéÆ Games Collection</h2>
      <div id="gamesGrid" class="grid" aria-live="polite"></div>
      <div id="noResults" class="center meta" style="display:none;margin-top:28px">No games found.</div>
    </section>

    <div class="footer">
      üí° <strong>Tip:</strong> Click a card to open the game in the modal. Use fullscreen for the best experience.
    </div>
  </main>

  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-hidden="true">
    <div class="modal" role="document">
      <header>
        <div style="display:flex;gap:12px;align-items:center">
          <strong id="modalTitle" class="modal-title">Loading‚Ä¶</strong>
          <span id="modalMeta" style="color:#8b92a8;font-size:13px"></span>
        </div>
        <div style="display:flex;gap:10px;align-items:center">
          <button id="fullscreenBtn" class="btn small">Fullscreen</button>
          <button id="closeModal" class="btn small" style="background:#1a1a1a">Close</button>
        </div>
      </header>
      <div class="iframe-wrap" id="iframeWrap">
        <div id="gameLoader" class="game-loader">
          <div class="game-loader-spinner"></div>
          <div class="game-loader-text">Loading game...</div>
          <div class="game-loader-tip">Tip: Some games may take longer on slower connections</div>
          <div id="timeoutMessage" class="timeout-message">
            <h3>‚ö†Ô∏è Loading Taking Too Long?</h3>
            <p>The game might be having trouble loading. This could be due to a slow connection or the game server being slow.</p>
            <button id="retryBtn" class="btn small">Retry</button>
            <button id="openNewTabBtn" class="btn small ghost" style="margin-left:10px">Open in New Tab</button>
          </div>
        </div>
        <iframe id="gameFrame" src="about:blank" sandbox="allow-scripts allow-forms allow-pointer-lock allow-same-origin" loading="lazy"></iframe>
      </div>
    </div>
  </div>

  <script>
    window.addEventListener('load',()=>{setTimeout(()=>{document.getElementById('loadingScreen').classList.add('hidden')},2500)});

    const ZONES_JSON_URL="https://cdn.jsdelivr.net/gh/gn-math/assets@main/zones.json";
    const COVERS_BASE_URL="https://cdn.jsdelivr.net/gh/gn-math/covers@main";
    const HTML_BASE_URL="https://cdn.jsdelivr.net/gh/gn-math/html@main";

    const searchEl=document.getElementById('search');
    const grid=document.getElementById('gamesGrid');
    const noResults=document.getElementById('noResults');
    const refreshBtn=document.getElementById('refreshBtn');
    const exportBtn=document.getElementById('exportBtn');
    const importBtn=document.getElementById('importBtn');
    const importFile=document.getElementById('importFile');
    const importPopup=document.getElementById('importPopup');
    const importMessage=document.getElementById('importMessage');
    const countdown=document.getElementById('countdown');
    const modalBackdrop=document.getElementById('modalBackdrop');
    const modalTitle=document.getElementById('modalTitle');
    const modalMeta=document.getElementById('modalMeta');
    const gameFrame=document.getElementById('gameFrame');
    const iframeWrap=document.getElementById('iframeWrap');
    const gameLoader=document.getElementById('gameLoader');
    const timeoutMessage=document.getElementById('timeoutMessage');
    const retryBtn=document.getElementById('retryBtn');
    const openNewTabBtn=document.getElementById('openNewTabBtn');
    const closeModal=document.getElementById('closeModal');
    const fullscreenBtn=document.getElementById('fullscreenBtn');

    let zones=[];
    let currentZone=null;
    let loadTimeout=null;
    let htmlCache={};

    function createCard(game,index){
      const a=document.createElement('div');
      a.className='card';
      a.title=game.name;
      a.dataset.id=game.id;
      a.style.setProperty('--i',index);
      const cover=(game.cover||'').replace("{COVER_URL}",COVERS_BASE_URL).replace("{HTML_URL}",HTML_BASE_URL);
      const img=document.createElement('img');
      img.src=cover;
      img.alt=game.name;
      img.loading='lazy';
      const label=document.createElement('div');
      label.className='label';
      label.textContent=game.name;
      a.appendChild(img);
      a.appendChild(label);
      a.addEventListener('click',()=>openGame(game));
      return a;
    }

    async function fetchZones(){
      grid.innerHTML='';
      noResults.style.display='none';
      try{
        const res=await fetch(`${ZONES_JSON_URL}?t=${Date.now()}`,{
          signal:AbortSignal.timeout(10000)
        });
        if(!res.ok)throw new Error('Failed to fetch zones.json');
        const all=await res.json();
        zones=all.filter(z=>String(z.id)!=='-1');
        renderZones(zones);
      }catch(err){
        console.error('Error loading zones.json',err);
        grid.innerHTML='<div class="meta center">Failed to load games list. Check console for details.</div>';
      }
    }

    function renderZones(list){
      grid.innerHTML='';
      if(!list||list.length===0){
        noResults.style.display='block';
        return;
      }
      const frag=document.createDocumentFragment();
      list.forEach((game,index)=>frag.appendChild(createCard(game,index)));
      grid.appendChild(frag);
    }

    function filterZones(){
      const q=(searchEl.value||'').toLowerCase().trim();
      if(!q){
        renderZones(zones);
        return;
      }
      const results=zones.filter(g=>(g.name||'').toLowerCase().includes(q));
      renderZones(results);
      if(!results.length)noResults.style.display='block';else noResults.style.display='none';
    }

    async function openGame(zone){
      currentZone=zone;
      modalTitle.textContent=zone.name;
      modalMeta.textContent=` ‚Ä¢ id: ${zone.id}`;
      showModal();
      showLoader();
      
      clearTimeout(loadTimeout);
      loadTimeout=setTimeout(()=>{
        timeoutMessage.classList.add('show');
      },15000);

      const url=(zone.url||'').replace("{COVER_URL}",COVERS_BASE_URL).replace("{HTML_URL}",HTML_BASE_URL);
      
      if(htmlCache[url]){
        loadCachedGame(url);
        return;
      }

      try{
        const controller=new AbortController();
        const timeout=setTimeout(()=>controller.abort(),20000);
        
        const response=await fetch(`${url}?t=${Date.now()}`,{
          signal:controller.signal,
          cache:'force-cache'
        });
        clearTimeout(timeout);
        
        if(!response.ok){
          throw new Error('Fetch returned '+response.status);
        }
        
        const html=await response.text();
        htmlCache[url]=html;
        
        const iframeDoc=gameFrame.contentDocument||gameFrame.contentWindow.document;
        iframeDoc.open();
        iframeDoc.write(html);
        iframeDoc.close();
        
        gameFrame.onload=()=>{
          hideLoader();
          clearTimeout(loadTimeout);
        };
        
        setTimeout(()=>{
          if(!gameLoader.classList.contains('hidden')){
            hideLoader();
          }
        },3000);
        
      }catch(err){
        console.warn('Failed to fetch HTML. Trying direct iframe src method. Error:',err);
        try{
          gameFrame.src=url;
          gameFrame.onload=()=>{
            hideLoader();
            clearTimeout(loadTimeout);
          };
          setTimeout(()=>{
            if(!gameLoader.classList.contains('hidden')){
              hideLoader();
            }
          },5000);
        }catch(err2){
          console.error('Failed to load game',err2);
          hideLoader();
          clearTimeout(loadTimeout);
          alert('Failed to load game. Opening in new tab instead.');
          window.open(url,'_blank');
          hideModal();
        }
      }
    }

    function loadCachedGame(url){
      const html=htmlCache[url];
      try{
        const iframeDoc=gameFrame.contentDocument||gameFrame.contentWindow.document;
        iframeDoc.open();
        iframeDoc.write(html);
        iframeDoc.close();
        setTimeout(()=>hideLoader(),500);
      }catch(e){
        gameFrame.src=url;
        setTimeout(()=>hideLoader(),1000);
      }
    }

    function showLoader(){
      gameLoader.classList.remove('hidden');
      timeoutMessage.classList.remove('show');
    }

    function hideLoader(){
      gameLoader.classList.add('hidden');
      timeoutMessage.classList.remove('show');
    }

    retryBtn.addEventListener('click',()=>{
      if(currentZone){
        delete htmlCache[(currentZone.url||'').replace("{COVER_URL}",COVERS_BASE_URL).replace("{HTML_URL}",HTML_BASE_URL)];
        openGame(currentZone);
      }
    });

    openNewTabBtn.addEventListener('click',()=>{
      if(currentZone){
        const url=(currentZone.url||'').replace("{COVER_URL}",COVERS_BASE_URL).replace("{HTML_URL}",HTML_BASE_URL);
        window.open(url,'_blank');
        hideModal();
      }
    });

    function showModal(){
      modalBackdrop.classList.add('show');
      modalBackdrop.style.visibility='visible';
      modalBackdrop.style.opacity='1';
      modalBackdrop.setAttribute('aria-hidden','false');
    }

    function hideModal(){
      modalBackdrop.classList.remove('show');
      modalBackdrop.style.visibility='hidden';
      modalBackdrop.style.opacity='0';
      modalBackdrop.setAttribute('aria-hidden','true');
      gameFrame.src='about:blank';
      try{
        const d=gameFrame.contentDocument||gameFrame.contentWindow.document;
        d.open();d.write('');d.close();
      }catch(e){}
      hideLoader();
      clearTimeout(loadTimeout);
      currentZone=null;
    }

    closeModal.addEventListener('click',hideModal);
    modalBackdrop.addEventListener('click',(ev)=>{if(ev.target===modalBackdrop)hideModal()});

    fullscreenBtn.addEventListener('click',()=>{
      try{
        const elem=iframeWrap;
        if(elem.requestFullscreen){
          elem.requestFullscreen();
        }else if(elem.webkitRequestFullscreen){
          elem.webkitRequestFullscreen();
        }else if(elem.mozRequestFullScreen){
          elem.mozRequestFullScreen();
        }else if(elem.msRequestFullscreen){
          elem.msRequestFullscreen();
        }
      }catch(e){
        console.warn('Fullscreen not supported',e);
      }
    });

    searchEl.addEventListener('input',debounce(filterZones,250));
    refreshBtn.addEventListener('click',fetchZones);

    function sanitizeData(obj,maxStringLen=1000,maxArrayLen=10000){
      if(typeof obj==='string'){
        return obj.length>maxStringLen?obj.slice(0,maxStringLen)+'...[truncated]':obj;
      }
      if(obj instanceof Uint8Array){
        if(obj.length>maxArrayLen){
          return `[Uint8Array too large (${obj.length} bytes), truncated]`;
        }
        return obj;
      }
      if(Array.isArray(obj)){
        return obj.map(item=>sanitizeData(item,maxStringLen,maxArrayLen));
      }
      if(obj&&typeof obj==='object'){
        const newObj={};
        for(const key in obj){
          if(obj.hasOwnProperty(key)){
            newObj[key]=sanitizeData(obj[key],maxStringLen,maxArrayLen);
          }
        }
        return newObj;
      }
      return obj;
    }

    async function saveData(){
      const result={};
      result.cookies=document.cookie;
      result.localStorage={...localStorage};
      result.sessionStorage={...sessionStorage};
      result.indexedDB={};
      try{
        const dbs=await indexedDB.databases();
        for(const dbInfo of dbs){
          if(!dbInfo.name)continue;
          result.indexedDB[dbInfo.name]={};
          await new Promise((resolve,reject)=>{
            const openRequest=indexedDB.open(dbInfo.name,dbInfo.version);
            openRequest.onerror=()=>reject(openRequest.error);
            openRequest.onsuccess=()=>{
              const db=openRequest.result;
              const storeNames=Array.from(db.objectStoreNames);
              if(storeNames.length===0){
                resolve();
                return;
              }
              const transaction=db.transaction(storeNames,"readonly");
              const storePromises=[];
              for(const storeName of storeNames){
                result.indexedDB[dbInfo.name][storeName]=[];
                const store=transaction.objectStore(storeName);
                const getAllRequest=store.getAll();
                const p=new Promise((res,rej)=>{
                  getAllRequest.onsuccess=()=>{
                    result.indexedDB[dbInfo.name][storeName]=sanitizeData(getAllRequest.result,1000,100);
                    res();
                  };
                  getAllRequest.onerror=()=>rej(getAllRequest.error);
                });
                storePromises.push(p);
              }
              Promise.all(storePromises).then(()=>resolve());
            };
          });
        }
      }catch(e){
        console.error("IndexedDB export failed:",e);
      }
      const link=document.createElement("a");
      link.href=URL.createObjectURL(new Blob([JSON.stringify(result)],{type:"application/json"}));
      link.download=`site-data-${Date.now()}.json`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    async function loadData(event){
      const file=event.target.files[0];
      if(!file)return;
      const reader=new FileReader();
      reader.onload=async function(e){
        try{
          const data=JSON.parse(e.target.result);
          if(data.cookies){
            data.cookies.split(';').forEach(cookie=>{
              document.cookie=cookie.trim();
            });
          }
          if(data.localStorage){
            localStorage.clear();
            for(const key in data.localStorage){
              localStorage.setItem(key,data.localStorage[key]);
            }
          }
          if(data.sessionStorage){
            sessionStorage.clear();
            for(const key in data.sessionStorage){
              sessionStorage.setItem(key,data.sessionStorage[key]);
            }
          }
          if(data.indexedDB){
            for(const dbName in data.indexedDB){
              await new Promise((resolve,reject)=>{
                const deleteRequest=indexedDB.deleteDatabase(dbName);
                deleteRequest.onsuccess=resolve;
                deleteRequest.onerror=reject;
                deleteRequest.onblocked=()=>{
                  console.warn("IndexedDB delete blocked for",dbName);
                  resolve();
                };
              });
              const stores=data.indexedDB[dbName];
              const request=indexedDB.open(dbName,1);
              request.onupgradeneeded=e=>{
                const db=e.target.result;
                for(const storeName in stores){
                  if(!db.objectStoreNames.contains(storeName)){
                    db.createObjectStore(storeName,{autoIncrement:true});
                  }
                }
              };
              request.onsuccess=e=>{
                const db=e.target.result;
                const transaction=db.transaction(Object.keys(stores),'readwrite');
                for(const storeName in stores){
                  const objectStore=transaction.objectStore(storeName);
                  stores[storeName].forEach(item=>objectStore.put(item));
                }
                resolve();
              };
              request.onerror=()=>reject(request.error);
            }
          }
          
          importPopup.classList.add('show');
          let seconds=5;
          countdown.textContent=seconds;
          const timer=setInterval(()=>{
            seconds--;
            countdown.textContent=seconds;
            if(seconds<=0){
              clearInterval(timer);
              window.close();
            }
          },1000);
          
        }catch(err){
          alert(`Failed to load data: ${err.message}`);
        }
      };
      reader.readAsText(file);
    }

    exportBtn.addEventListener('click',saveData);
    importBtn.addEventListener('click',()=>importFile.click());
    importFile.addEventListener('change',loadData);

    function debounce(fn,wait){let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn.apply(this,a),wait)}}

    fetchZones();
  </script>
</body>
</html>
